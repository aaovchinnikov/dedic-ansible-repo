*mangle
COMMIT

*nat
COMMIT

*filter
-A INPUT -m state --state INVALID -j DROP
-A INPUT -p icmp -j  ACCEPT
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A INPUT -i lo -j ACCEPT

# SSH with securing from bruteforce
-A INPUT -s {{ ssh_trusted_cidr }} -p tcp -m tcp --dport {{ ansible_port }} -m state --state NEW -m recent --name SSH --rcheck --seconds 60 --hitcount 3 -j LOG --log-prefix "SSH-shield: "
-A INPUT -s {{ ssh_trusted_cidr }} -p tcp -m tcp --dport {{ ansible_port }} -m state --state NEW -m recent --name SSH --update --seconds 60 --hitcount 3 -j DROP
-A INPUT -s {{ ssh_trusted_cidr }} -p tcp -m tcp --dport {{ ansible_port }} -m state --state NEW -m recent --set --name SSH -j ACCEPT

# Final INPUT REJECT
-A INPUT -j REJECT --reject-with icmp-admin-prohibited


-A FORWARD -m state --state INVALID -j DROP
-A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT

# Final FORWARD REJECT
-A FORWARD -j REJECT --reject-with icmp-admin-prohibited
COMMIT
